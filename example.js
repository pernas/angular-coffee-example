// Generated by CoffeeScript 1.9.1
(function() {
  'use strict';
  var Just, Nothing, _bind, _unit;

  _bind = function(f) {
    switch (this) {
      case Nothing:
        return Nothing;
      default:
        return f(this.val);
    }
  };

  _unit = function(input) {
    return Object.freeze({
      val: input != null ? input : null,
      bind: _bind
    });
  };

  Nothing = _unit(null);

  Just = function(input) {
    if (input != null) {
      return _unit(input);
    } else {
      return Nothing;
    }
  };

  angular.module('pernas.example', []).directive('example', [
    'EntropyService', function(EntropyService) {
      return {
        restrict: 'E',
        template: 'Hola {{nom}}, com va? tens {{punts}} punts',
        controller: [
          '$scope', function($scope) {
            $scope.name = "Jaume";
            $scope.MaybeName = Just("Enric");
            $scope.nom = $scope.MaybeName.val;
            $scope.entropy = EntropyService.entropy;
            return $scope.punts = $scope.entropy($scope.nom);
          }
        ]
      };
    }
  ]).factory('EntropyService', function() {
    var H, base, entropy2, entropyWeighted, hasDigits, hasLowerCase, hasPunctuation, hasUpperCase, maybePassword, password, patternsList, quality, scorePassword;
    H = 0;
    password = '';
    Math.log2 = function(x) {
      return Math.log(x) / Math.LN2;
    };
    hasDigits = function(str) {
      return /[0-9]/.test(str);
    };
    hasLowerCase = function(str) {
      return /[a-z]/.test(str);
    };
    hasUpperCase = function(str) {
      return /[A-Z]/.test(str);
    };
    hasPunctuation = function(str) {
      return /[-!$%^&*()_+|~=`{}\[\]:";'<>?@,.\/]/.test(str);
    };
    base = function(str) {
      var b, bases, t, tuples;
      tuples = [[10, hasDigits(str)], [26, hasLowerCase(str)], [26, hasUpperCase(str)], [31, hasPunctuation(str)]];
      bases = (function() {
        var i, len, results;
        results = [];
        for (i = 0, len = tuples.length; i < len; i++) {
          t = tuples[i];
          if (t[1]) {
            results.push(t[0]);
          }
        }
        return results;
      })();
      b = bases.reduce((function(t, s) {
        return t + s;
      }), 0);
      if (b === 0) {
        return 1;
      } else {
        return b;
      }
    };
    maybePassword = function(str) {
      if (str === "" || (str == null) || (typeof str) !== 'string') {
        return Nothing;
      } else {
        return Just(str);
      }
    };
    entropy2 = function(str) {
      return maybePassword(str).bind(function(pw) {
        return Just(Math.log2(Math.pow(base(pw), pw.length)));
      });
    };
    patternsList = [[0.5, /^\d+$/], [0.5, /^[a-z]+\d$/], [0.5, /^[A-Z]+\d$/], [0.75, /^[a-zA-Z]+\d$/], [0.75, /^[a-z]+\d+$/], [0.5, /^[a-z]+$/], [0.5, /^[A-Z]+$/], [0.5, /^[A-Z][a-z]+$/], [0.5, /^[A-Z][a-z]+\d$/], [0.75, /^[A-Z][a-z]+\d+$/], [0.5, /^[a-z]+[._!\- @*#]$/], [0.5, /^[A-Z]+[._!\- @*#]$/], [0.75, /^[a-zA-Z]+[._!\- @*#]$/], [0.5, /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]+$/], [1, /^.*$/]];
    quality = function(str, patterns) {
      var p;
      return Math.min.apply(this, (function() {
        var i, len, results;
        results = [];
        for (i = 0, len = patterns.length; i < len; i++) {
          p = patterns[i];
          if (p[1].test(str)) {
            results.push(p[0]);
          }
        }
        return results;
      })());
    };
    entropyWeighted = function(str, patterns) {
      return (entropy2(str)).bind(function(e) {
        return Just(e * quality(str, patterns));
      });
    };
    scorePassword = function(str) {
      var s;
      s = entropyWeighted(str, patternsList);
      switch (s) {
        case Nothing:
          return 0;
        default:
          if (s.val > 100) {
            return 100;
          } else {
            return s.val;
          }
      }
    };
    return {
      entropy: function(pass) {
        if (pass !== password) {
          password = pass;
          return H = scorePassword(pass);
        } else {
          return H;
        }
      }
    };
  });

}).call(this);
